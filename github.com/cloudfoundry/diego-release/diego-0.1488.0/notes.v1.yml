{
  "Content": "## Changes from v0.1487.0 to v0.1488.0\n- Verified with [garden-runc-release v1.0.2](https://github.com/cloudfoundry/garden-runc-release/releases/tag/v1.0.2).\n- Verified with [garden-windows-bosh-release v0.0.9](https://github.com/pivotal-cf-experimental/garden-windows-bosh-release/releases/tag/v0.0.9).\n- Verified with [etcd-release v78](https://github.com/cloudfoundry-incubator/etcd-release/releases/tag/v78).\n- Verified with [cflinuxfs2-rootfs-release v1.38.0](https://github.com/cloudfoundry/cflinuxfs2-rootfs-release/releases/tag/v1.38.0).\n\n**IMPORTANT**: Diego v0.1488.0 includes configuration to secure the cell rep API via mutual TLS authentication. Please consult [\"Upgrading to a TLS-Secured Cell Rep API\"](https://github.com/cloudfoundry/diego-release/blob/develop/docs/upgrading-secure-cell-rep-api.md) in the diego-release documentation for detailed steps on how to enable this security without incurring downtime in the Diego deployment. We recommend that all operators enable this security configuration, and doing so on upgrading from v0.1487.0 or earlier requires one fewer deployment step than doing so after upgrading to v0.1488.0 or later.\n\n**IMPORTANT**: Diego v0.1488.0 requires v1.0.2 or later of [garden-runc-release](https://github.com/cloudfoundry/garden-runc-release) on Linux cells, and [garden-linux-release](https://github.com/cloudfoundry-attic/garden-linux-release) is no longer supported. This change is required because [Diego story #133264039](https://www.pivotaltracker.com/story/show/133264039) makes use of a new Garden API call, `BulkNetOut`, that is available only on v1.0.2 of garden-runc-release. Version v0.0.9 of garden-windows-bosh-release is also supported. The manifest generation scripts in diego-release now default to using garden-runc-release as the Linux implementation of the Garden backend instead of garden-linux-release, and the `-g` flag is now deprecated as a no-op. Please note that changing from garden-linux-release to garden-runc-release **requires operators to recreate their Diego cell VMs** (either explicitly or as a side-effect of a stemcell deploy), as upgrading from garden-linux to garden-runc in place is not supported. Also, the garden-runc-release repository recently moved to the \"cloudfoundry\" GitHub organization, so [https://bosh.io/releases/github.com/cloudfoundry/garden-runc-release](https://bosh.io/releases/github.com/cloudfoundry/garden-runc-release) is now the correct source for final BOSH releases.\n\n### Significant changes\n\n#### BBS API\n- [As a Diego operator, I expect BBS event consumers not to leak connections on failure](https://www.pivotaltracker.com/story/show/130215763)\n\n#### BBS Relational Datastore\n- [Investigate using a less strict isolation level when using mysql as the bbs backend store](https://www.pivotaltracker.com/story/show/131308797)\n- [Slow convergence on postgres with many actual lrps](https://www.pivotaltracker.com/story/show/133299045)\n\n#### Container Placement\n- [As a BBS API client, I would like to observe that my LRP instances are not running or my Tasks have failed because there are no cells available matching those placement tags](https://www.pivotaltracker.com/story/show/129370089)\n- [As a Diego operator, I expect reps on windows to consume placement-tags configuration](https://www.pivotaltracker.com/story/show/132595975)\n- [Fix regression: spaces should be allowed in cell rep AZ](https://www.pivotaltracker.com/story/show/133299443)\n\n#### Component Coordination\n- [As a Diego operator, I expect the default lock TTL to be set to 15 seconds](https://www.pivotaltracker.com/story/show/131921891) (in flight)\n\n#### `cfdot`\n- [As a cfdot user, I expect to be able to update a DesiredLRP](https://www.pivotaltracker.com/story/show/129376215)\n- [As a cfdot user, I expect to be able to retrieve a single Task from the BBS by its guid](https://www.pivotaltracker.com/story/show/129376217)\n\n#### SSH\n- [As a Diego operator, I expect the ssh-proxy to present an endpoint for an HTTP healthcheck](https://www.pivotaltracker.com/story/show/130616967)\n- [cloudfoundry/diego-ssh #24: Connection resets](https://www.pivotaltracker.com/story/show/132073051)\n\n#### Routing\n- [cloudfoundry/route-emitter #5: Keep emitting routes when losing the lock and consul is unhealthy](https://www.pivotaltracker.com/story/show/133222927)\n\n#### Volume Support (Experimental)\n- [monit stop/start volume drivers should not lead to bad cell state](https://www.pivotaltracker.com/story/show/130494493)\n- [Executor scans and removes unused volume mounts upon startup](https://www.pivotaltracker.com/story/show/130659367)\n- [Retry failed voldriver operations](https://www.pivotaltracker.com/story/show/130667113)\n- [cancel driver mount when connection drops for mount on localvolume](https://www.pivotaltracker.com/story/show/130944305)\n- [use new lager.Context when mounting](https://www.pivotaltracker.com/story/show/131219935)\n- [Wire cancellation logic into all voldriver handlers](https://www.pivotaltracker.com/story/show/131403893)\n- [clean up and extract voldiver backoff into it's own package](https://www.pivotaltracker.com/story/show/132045361)\n- [Refactor voldriver's remote client to use the new backoff package](https://www.pivotaltracker.com/story/show/132631249)\n\n#### Container Networking Support (Experimental)\n- [Fix failing vizzini test for ASGs ](https://www.pivotaltracker.com/story/show/132951579)\n- [cloudfoundry/vizzini #1: ASG tests no longer depend on a listener LRP](https://www.pivotaltracker.com/story/show/133122849)\n\n#### Garden-RunC Integration\n- [As a Diego operator, I expect garden-runc to be the only officially supported Linux garden backend](https://www.pivotaltracker.com/story/show/133000417)\n- [As a Diego operator, I expect Diego to use Garden's new BulkNetOut API to reduce container start-up time on 4.4-kernel systems](https://www.pivotaltracker.com/story/show/133264039)\n\n#### Component Logging and Metrics\n- [As a Diego operator, I expect the BBS to produce an info-level log when starting an ActualLRP only if it makes a real change to the etcd store](https://www.pivotaltracker.com/story/show/131598997)\n\n#### Test Suites and Tooling\n- [cloudfoundry/consuladapter #4: Skip over consul when resetting Consul services](https://www.pivotaltracker.com/story/show/133150625)\n\n#### Security\n- [As a Diego operator, I expect the cell reps also to serve their API on a port that can be configured to accept only TLS connections](https://www.pivotaltracker.com/story/show/130664745)\n- [As a Diego operator, I expect the BBS and auctioneer cell clients to prefer communicating to the cells on their TLS-configurable ports if possible](https://www.pivotaltracker.com/story/show/130664747)\n- [As a Diego operator, I expect to be able to configure the cell reps to accept only secure communication from remote sources](https://www.pivotaltracker.com/story/show/130664751)\n\n#### Documentation\n- [As an OSS developer, I expect the cloudfoundry/debugserver repository to explain its endpoints via its README](https://www.pivotaltracker.com/story/show/126556461)\n- [As a Diego operator, I expect to be able to discover documentation about and examples for the deploying windows cells](https://www.pivotaltracker.com/story/show/127397145)\n- [Change developer instructions to use consul 0.7.0](https://www.pivotaltracker.com/story/show/131200651)\n\n#### Cleanup\n- [As a Diego maintainer, I expect not to have the canary job or its dependencies in diego-release](https://www.pivotaltracker.com/story/show/128616257)\n\n#### De-Incubation\n- [Convert cflager package into a subpackage of lager](https://www.pivotaltracker.com/story/show/125073871)\n\n### BOSH job changes\n\nRemoved `canary` job.\n\n### BOSH property changes\n- Added `diego.auctioneer.rep.require_tls`: Whether the auctioneer requires communication to the rep via TLS.\n- Added `diego.auctioneer.rep.ca_cert`: CA certificate for communication from the auctioneer to the rep.\n- Added `diego.auctioneer.rep.client_cert`: Client certificate for communication from the auctioneer to the rep.\n- Added `diego.auctioneer.rep.client_key`: Client key for communication from the auctioneer to the rep.\n- Added `diego.auctioneer.rep.client_session_cache_size`: Size of the TLS session cache for the auctioneer to keep for communication to the rep.\n- Added `diego.bbs.rep.require_tls`: Whether the BBS requires communication to the rep via TLS.\n- Added `diego.bbs.rep.ca_cert`: CA certificate for communication from the BBS to the rep.\n- Added `diego.bbs.rep.client_cert`: Client certificate for communication from the BBS to the rep.\n- Added `diego.bbs.rep.client_key`: Client key for communication from the BBS to the rep.\n- Added `diego.bbs.rep.client_session_cache_size`: Size of the TLS session cache for the BBS to keep for communication to the rep.\n- Added `diego.rep.enable_legacy_api_endpoints`: Whether to enable the auction, LRP, and Task endpoints on the legacy rep API server\n- Added `diego.rep.listen_addr_admin`: If legacy endpoints are disabled, the address and port on which to serve the administrative endpoints used to ping and drain the rep.\n- Added `diego.rep.advertise_domain`: Base domain at which the rep should advertise its secure API\n- Added `diego.rep.listen_addr_securable`: Address and port for the TLS-capable server on which the rep serves its workload (Task and LRP) endpoints.\n- Added `diego.rep.require_tls`: Whether to require mutual TLS for communication to the securable rep API server.\n- Added `diego.rep.ca_cert`: CA certificate for the rep to use in its TLS-capable API server.\n- Added `diego.rep.server_cert`: Certificate for the rep to present from its TLS-capable API server.\n- Added `diego.rep.server_key`: Key for the rep to use in its TLS-capable API server.\n- Added `diego.ssh_proxy.healthcheck_listen_addr`: Address and port on which the SSH proxy health-check server listens.\n- Removed all `diego.canary.*` properties.\n"
}