{
  "Content": "## Highlights\n- Support AWS multi-availability zone deployments #[87241160](https://www.pivotaltracker.com/story/show/87241160)\u003cbr\u003e\n  See below for upgrade instructions.\n  - Added networks and resource pools for Multiple AZs\n  - Updated job names for Multiple AZs\n- Operator can now configure cf-mysql-release with different instance types for each job #[87242348](https://www.pivotaltracker.com/story/show/87242348)\n- Improved Operator-visible logging from mariadb_ctrl #[88102590](https://www.pivotaltracker.com/story/show/88102590)\n- We have updated MariaDB to version 10.0.17, Galera to 25.3.9, and Xtrabackup to 2.2.10 #[90127848](https://www.pivotaltracker.com/story/show/90127848), #[94023216](https://www.pivotaltracker.com/story/show/94023216)\n- use xtrabackup-v2 as replication mechanism (improved stability during replication) #[88835488](https://www.pivotaltracker.com/story/show/88835488)\n- Compile against the MariaDB connector instead of additionally including the MySQL connector #[92725528](https://www.pivotaltracker.com/story/show/92725528)\n- We have rewritten the Quota Enforcer to improve stability #[88665590](https://www.pivotaltracker.com/story/show/88665590)\n\n### New Documentation\n- How to upgrade a MySQL service plan #[91748318](https://www.pivotaltracker.com/story/show/91748318)\n- Specify instance sizing in BOSH manifests: [Deployment Resources](https://github.com/cloudfoundry/cf-mysql-release/blob/v20/docs/deployment-resources.md) #[89325154](https://www.pivotaltracker.com/story/show/89325154)\n\n### Bug Fixes and Miscellaneous Changes\n- Once over quota, write privs are not restored by dropping all tables #[86454200](https://www.pivotaltracker.com/story/show/86454200)\n- Upgrade sample stub to allow self signed certificates #[82316314](https://www.pivotaltracker.com/story/show/82316314)\n- CF-MySQL service broker must speak to the CC API via SSL #[93485852](https://www.pivotaltracker.com/story/show/93485852)\n- Update Ruby version for service broker - address any CVEs #[93485852](https://www.pivotaltracker.com/story/show/93485852)\n- Upgrade Rails and other gems to latest version for broker repos #[86044548](https://www.pivotaltracker.com/story/show/86044548)\n- Configurable defaults for MariaDB in-memory behavior #[94043690](https://www.pivotaltracker.com/story/show/94043690)\u003cbr\u003e\n  \u003cpre\u003emax_heap_table_size = 16777216 # Rows\n  tmp_table_size = 33554432 # Bytes\u003c/pre\u003e\n- Compilation instances now use new instance types on AWS #[89434250](https://www.pivotaltracker.com/story/show/89434250)\n- Added small bosh-lite helper scripts\n- Improved MySQL node startup speed\n  - Nodes come online more quickly\n  - Nodes fail faster if sub-processes fail\n- Enabled option to run acceptance-tests errand against pre-existing org (instead of creating a random one each time) #[90070764](https://www.pivotaltracker.com/story/show/90070764)\n\n## v20 Upgrade Instructions for AWS  #[93040612](https://www.pivotaltracker.com/story/show/93040612)\n\nIf you've deployed v19 or earlier, there are specific manifest changes you'll need to make to take advantage of the new multi-AZ templates. You'll need to rename the mysql job to mysql_z1; this is a one-time change as you upgrade to v20. Future versions of cf-mysql-release will continue to use the _z1, _z2, _z3 pattern.\n1. Download existing manifest\u003cbr\u003e\n   \u003cpre\u003e$ bosh download manifest [your deployment name] cf-mysql-deployment.yml\u003c/pre\u003e\n2. Set manifest to newly-downloaded manifest\u003cbr\u003e\n   \u003cpre\u003ebosh deployment cf-mysql-deployment.yml\u003c/pre\u003e\n3. Edit the manifest to rename `mysql` job to `mysql_z1`\u003cbr\u003e\n   \u003cpre\u003e$ bosh edit deployment\u003c/pre\u003e\n4. Rename job\u003cbr\u003e\n   \u003cpre\u003e$ bosh rename job mysql mysql_z1\u003c/pre\u003e\n5. Create a stub file called `cf-mysql-aws-stub.yml` by copying and modifying the [sample_aws_stub.yml](https://github.com/cloudfoundry/cf-mysql-release/blob/master/templates/sample_stubs/sample_aws_stub.yml) in `templates/sample_stubs`.\u003cbr\u003e\n   \u003cpre\u003e$ cp templates/sample_stubs/sample_aws_stub.yml cf-mysql-aws-stub.yml\u003c/pre\u003e\n6. Make a new manifest with multiple availability zones\u003cbr\u003e\n   \u003cpre\u003e$ ./generate_deployment_manifest aws cf-mysql-aws-stub.yml \u003e cf-mysql-new.yml\u003c/pre\u003e\n7. Set manifest to newly-created manifest\u003cbr\u003e\n   \u003cpre\u003e$ bosh deployment cf-mysql-new.yml\u003c/pre\u003e\n8. Edit manifest\u003cbr\u003e\n   \u003cpre\u003e$ bosh edit deployment\u003c/pre\u003e\n   Configure only one node of mysql_z1 and 0 of mysql_z2 and mysql_z3\n   - Set instances of `mysql_z2` and `mysql_z3` to 0\n   - Remove static ips from `mysql_z2` and `mysql_z3`\n   - Set cluster IPs on `mysql_z1` to just the IP of the `mysql_z1` instance\n   - Set cluster IPs on proxy jobs to just the IP of the `mysql_z1` instance\n9. Deploy (resulting in a single mysql node, 2 brokers and 2 proxies correctly distributed across AZs)\u003cbr\u003e\n   \u003cpre\u003e$ bosh deploy\u003c/pre\u003e\n10. Validate by running `bosh vms cf-mysql`. Your output should look similar to this:\u003cbr\u003e\n    \u003cpre\u003e\n    +----------------------+---------+--------------------+-------------+\n    | Job/index            | State   | Resource Pool      | IPs         |\n    +----------------------+---------+--------------------+-------------+\n    | cf-mysql-broker_z1/0 | running | cf-mysql-broker_z1 | 10.10.3.101 |\n    | cf-mysql-broker_z2/0 | running | cf-mysql-broker_z2 | 10.10.4.101 |\n    | mysql_z1/0           | running | mysql_z1           | 10.10.3.10  |\n    | proxy_z1/0           | running | proxy_z1           | 10.10.3.11  |\n    | proxy_z2/0           | running | proxy_z2           | 10.10.4.11  |\n    +----------------------+---------+--------------------+-------------+\n    \u003c/pre\u003e\n11. Make a new manifest using templates, as above (leave unchanged at 3 mysql nodes, etc).\n12. Set manifest to newly-created manifest, as above.\n13. Deploy (resulting in 3 mysql nodes, 2 proxies and 2 brokers distributed across multiple AZs), as above.\n    Bosh should show you manifest changes that look similar to this:\u003cbr\u003e\n\n```\nJobs\nmysql_z1\n  properties\n    ± cluster_ips: \n      + 10.10.4.10\n      + 10.10.5.10\nmysql_z2\n  ± instances: \n    - 0\n    + 1\n  ± networks: \n    - {\"name\"=\u003e\"mysql2\", \"static_ips\"=\u003enil}\n    + {\"name\"=\u003e\"mysql2\", \"static_ips\"=\u003e[\"10.10.4.10\"]}\nmysql_z3\n  ± instances: \n    - 0\n    + 1\n  ± networks: \n    - {\"name\"=\u003e\"mysql3\", \"static_ips\"=\u003enil}\n    + {\"name\"=\u003e\"mysql3\", \"static_ips\"=\u003e[\"10.10.5.10\"]}\nproxy_z1\n  properties\n    ± cluster_ips: \n      + 10.10.4.10\n      + 10.10.5.10\nproxy_z2\n  properties\n    ± cluster_ips: \n      + 10.10.4.10\n      + 10.10.5.10\n```\n1. Validate by running `bosh vms cf-mysql`. Your output should look similar to this:\n   \u003cpre\u003e\n   +----------------------+---------+--------------------+-------------+\n   | Job/index            | State   | Resource Pool      | IPs         |\n   +----------------------+---------+--------------------+-------------+\n   | cf-mysql-broker_z1/0 | running | cf-mysql-broker_z1 | 10.10.3.101 |\n   | cf-mysql-broker_z2/0 | running | cf-mysql-broker_z2 | 10.10.4.101 |\n   | mysql_z1/0           | running | mysql_z1           | 10.10.3.10  |\n   | mysql_z2/0           | running | mysql_z2           | 10.10.4.10  |\n   | mysql_z3/0           | running | mysql_z3           | 10.10.5.10  |\n   | proxy_z1/0           | running | proxy_z1           | 10.10.3.11  |\n   | proxy_z2/0           | running | proxy_z2           | 10.10.4.11  |\n   +----------------------+---------+--------------------+-------------+\n   \u003c/pre\u003e\n"
}