{
  "Content": "# cf-mysql-release v36\n\nThe theme for `cf-mysql-release v36` is **security and tuning**!\n\nIn a world where MySQL is targeted by ransomware, it's important to keep your data stores are as secure as possible. You need specialized knowledge to deploy MySQL so that it is both secure and optimized for performance. It's especially difficult to go back and update existing servers.\n\n**`v36` adds fifteen security and performance improvements** and chooses **sane defaults** so that you don't have to be a DBA to run MySQL. Many of MySQL's standard settings are dated, and if left untuned, can spoil performance. Where it makes sense, we've updated the defaults or added a manifest property.\n\nUpgrading to `cf-mysql-release v36`, and keeping current with stemcells, will help protect your databases from well-known attacks.\n\n## Deprecation Delivered\n\nAs first mentioned with the [v34](https://github.com/cloudfoundry/cf-mysql-release/releases/tag/v34) release, we've removed `spiff` templates starting with `v36`. Please use [cf-mysql-deployment v36](https://github.com/cloudfoundry/cf-mysql-deployment/tree/v36) with the [bosh2 cli](http://bosh.io/docs/cli-v2.html) to deploy. Let us know how it goes for you! Please file a [GitHub issue](https://github.com/cloudfoundry/cf-mysql-deployment/issues) if you're having troubles!\n  - Remove all spiff manifest-generation [[#140167683](https://www.pivotaltracker.com/story/show/140167683)]\n\n## Dependency Updates\n\n- cf-mysql-release uses MariaDB 10.1.24 [[#147901169](https://www.pivotaltracker.com/story/show/147901169)]\n- Upgrade any golang components to v1.8.3 [[#145389045](https://www.pivotaltracker.com/story/show/145389045)]\n- Fix CVE-2017-5029 (nokogiri) in cf-mysql-broker  [[#147061901](https://www.pivotaltracker.com/story/show/147061901)]\n\n## Security and Tuning\n\nFor more information, refer to the [cluster configuration documentation](https://github.com/cloudfoundry/cf-mysql-release/blob/v36/docs/cluster-config.md) and read the descriptions in the [spec file](https://github.com/cloudfoundry/cf-mysql-release/blob/v36/jobs/mysql/spec).\n\n- Set MySQL server to skip symbolic links [[#144637795](https://www.pivotaltracker.com/story/show/144637795)]\n- As a developer, I don't want my MySQL client to accidentally send files from the client host [[#144637793](https://www.pivotaltracker.com/story/show/144637793)]\n- Set MySQL server variables so that users cannot interact with the MySQL server's file systems [[#144637789](https://www.pivotaltracker.com/story/show/144637789)]\n- Make it optional to not allow the server mysql CLI to keep a history file [[#144637787](https://www.pivotaltracker.com/story/show/144637787)]\n- Admin user should not be able to connect from arbitrary host via wildcard [[#144637779](https://www.pivotaltracker.com/story/show/144637779)]\n- Audit automatically-created users to ensure that have the minimum privileges necessary  [[#144637773](https://www.pivotaltracker.com/story/show/144637773)]\n- As an Operator, I'd like smoke-tests to run as a non-privileged user [[#145547181](https://www.pivotaltracker.com/story/show/145547181)]\n- cf-mysql-release has query_cache_type set to OFF [[#145565343](https://www.pivotaltracker.com/story/show/145565343)]\n- Operator can tune innodb_log_buffer_size, default to 32MB [[#145565355](https://www.pivotaltracker.com/story/show/145565355)]\n- Operator can configure innodb_large_prefix  [[#144634641](https://www.pivotaltracker.com/story/show/144634641)]\n- Operator can configure the size of the table_definition_cache [[#145565357](https://www.pivotaltracker.com/story/show/145565357)]\n- Operator can change the table_open_cache [[#145565341](https://www.pivotaltracker.com/story/show/145565341)]\n- Operator would like to deploy with innodb_strict_mode set to ON [[#145565345](https://www.pivotaltracker.com/story/show/145565345)]\n- Operator can configure innodb_flush_method [[#145565333](https://www.pivotaltracker.com/story/show/145565333)]\n- Operator can express buffer pool size to be a % which undersedes the setting that expresses it in megabytes [[#145938549](https://www.pivotaltracker.com/story/show/145938549)]\n\n  Make sure to check this last out. Where previously you had to change the buffer cache property whenever deploying to different sized VMs, you can set a new property to have cf-mysql-release automatically compute how much RAM to use for buffer cache!\n\n## Bugfixes and Other Improvements\n\n- Operator can specify a name for a cluster before initial deployment  [[#144962487](https://www.pivotaltracker.com/story/show/144962487)]\n  - Operator can follow documentation to change the cluster name of an existing deployment  [[#146552277](https://www.pivotaltracker.com/story/show/146552277)]\n\n    Use this to give your clusters a unique identifier. Now you can double-check that you're operating on the right deployment when running interactive MySQL.\n- When deploying a new cluster, an Operator may need to decrease the timeout used by MySQL to detect if other nodes already exist  [[#145287747](https://www.pivotaltracker.com/story/show/145287747)]\n- Operator is told when a persistent disk could not be found, or is less than 10GB [[#145971959](https://www.pivotaltracker.com/story/show/145971959)]\n- If no syslog configuration is provided we do not attempt to configure syslog [[#146544497](https://www.pivotaltracker.com/story/show/146544497)]\n- [BUG] cluster_health log miss several columns sometimes  [[#140438237](https://www.pivotaltracker.com/story/show/140438237)]\n- [BUG] When shutting down during the wrong BOSH phase, MySQL may fail to leave the cluster gracefully.  [[#145228885](https://www.pivotaltracker.com/story/show/145228885)]\n- [BUG] Operator should not be provided with an empty set of files when running download-logs [[#144945415](https://www.pivotaltracker.com/story/show/144945415)]\n\n  We significantly refactored `mariadb_ctrl`, the real brains behind `cf-mysql-release`.\n  - [BUG] mariadb_ctrl PostStartSQLFiles are run without error checking.  [[#146056211](https://www.pivotaltracker.com/story/show/146056211)]\n  - [BUG] mariadb_ctrl upgrade does not wait for mysqld shutdown  [[#145530067](https://www.pivotaltracker.com/story/show/145530067)]\n  - [BUG] mariadb_ctrl should wait for the database to be synced before moving on to seeding databases  [[#146052481](https://www.pivotaltracker.com/story/show/146052481)]\n  - mariadb_ctrl should use the link `bootstrap` property to determine if it is the bootstrap node [#145454113](https://www.pivotaltracker.com/story/show/145454113)\n\n- Release Integration can more easily consume BOSH links provided by cf-MySQL's jobs  [[#145350449](https://www.pivotaltracker.com/story/show/145350449)], [[#147457159](https://www.pivotaltracker.com/story/show/147457159)]\n\n#### cf-mysql-deployment improvements\n\n- As an Operator, I'd like to find an example operations file to set cf_mysql.host [[#139035695](https://www.pivotaltracker.com/story/show/139035695)]\n- Share the links in cf-mysql-deployment  [[#146118495](https://www.pivotaltracker.com/story/show/146118495)]\n\n---\n\n## Manifest Changes\n\n#### New Job: smoke-tests-user\n- This job should be colocated with MySQL if you would like to create the `smoke-tests` user.\n\n#### New Job: cf-mysql-broker-user\n- This job should be colocated with MySQL if you would like to create the `cf-mysql-broker`  and `quota-enforcer` users if the quota enforcer has been enabled.\n\n#### Proxy Job Spec Changes\n- `cf_mysql.mysql.cluster_ips`, `cf_mysql.proxy.proxy_ips`, `cf_mysql.proxy.arbitrator_ip` have been removed and are now only accessible via BOSH links.\n\n#### MySQL Job Spec Changes\n- The `mysql-database` link has been renamed to `internal-mysql-database` and its type is now `internal-database`.\n- The following properties have been added:\n - `cf_mysql.mysql.remote_admin_access`\n - `cf_mysql.mysql.innodb_buffer_pool_size_percent`\n - `cf_mysql.mysql.innodb_log_buffer_size`\n - `cf_mysql.mysql.innodb_flush_method`\n - `cf_mysql.mysql.innodb_large_prefix_enabled`\n - `cf_mysql.mysql.innodb_strict_mode`\n - `cf_mysql.mysql.table_definition_cache_size`\n - `cf_mysql.mysql.table_open_cache`\n - `cf_mysql.mysql.cluster_name`\n - `cf_mysql.mysql.cluster_probe_timeout`\n - `cf_mysql.mysql.cli_history`\n - `cf_mysql.mysql.enable_local_file`\n\n#### Arbitrator Job Spec Changes\n- `cf_mysql.mysql.cluster_ips` has been removed and are now only accessible via BOSH link.\n\n#### Bootstrap Errand Spec Changes\n- `cf_mysql.mysql.cluster_ips` has been removed and are now only accessible via BOSH link.\n`cf-mysql-broker`\n- The following properties are available through the `broker` link:\n - cf_mysql.broker.db_password\n - cf_mysql.broker.disable_quota_enforcer\n - cf_mysql.broker.quota_enforcer.password\n- `cf_mysql.mysql.admin_username`, `cf_mysql.mysql.admin_password` have been removed and are now only accessible via BOSH link.\n#### Rejoin-Unsafe Errand Spec Changes\n- `cf_mysql.mysql.cluster_ips` has been removed and are now only accessible via BOSH link.\n\n#### Smoke-Tests Errand Spec Changes\n- `cf_mysql.mysql.admin_username`, `cf_mysql.mysql.admin_password`, `cf_mysql.proxy.proxy_ips` have been removed and are now only accessible via BOSH link.\n- `cf_mysql.smoke_tests.db_password` will set the password for the user which has been created by the `smoke-tests-user` job.\n`verify-cluster-schemas`\n- `cf_mysql.mysql.cluster_ips`, `cf_mysql.proxy.arbitrator_ip`  have been removed and are now only accessible via BOSH link.\n\n---\n\n## Feedback Time: Allow table locks?\n\nIn v34, we removed Apps' ability to lock tables, as a way of enforcing the fact that Galera doesn't replicate [table locks](http://galeracluster.com/documentation-webpages/limitations.html#table-locking). Perhaps this was too strict?\n\nGalera is often advertised as a way to horizontally scale MySQL, but cf-mysql uses Galera solely to offer high uptime SLAs. We don't distribute reads and writes across the cluster, we keep a hot-spare (or two) for fast failover.\n\nWe feel that the work we've done in **[Switchboard](https://github.com/cloudfoundry-incubator/switchboard)**, our custom proxy, is sufficient to to direct traffic to only one backend, which means it'd be OK to use locks - no App instance will be using another backend, so no conflicts!\n\n- Roll back table lock prohibition? Click: [:ok_hand:](http://clickpoint.cfapps.io/click/tablelocks?allow-locks)\n- Nope, keep denying table locks? Click: [:no_entry:](http://clickpoint.cfapps.io/click/tablelocks?deny-locks)\n\nNo survey this time, please find us on Cloud Foundry Slack in [#core-services](https://cloudfoundry.slack.com/messages/core-services/) or contact us on GitHub!"
}