{
  "Content": "## Introduction\r\n\r\nThe docker-boshrelease was first introduced Apr 14, 2014 - three years ago - by the legendary @frodenas. It has been used in production systems for years - both running static clusters of containers, and as an API allowing dynamic provisioning/deprovisioning of containers (historically this was via Cloud Foundry) via the https://github.com/cloudfoundry-community/cf-containers-broker companion project.\r\n\r\n![screen shot 2017-04-12 at 11 06 39 pm](https://cloud.githubusercontent.com/assets/108/24992177/c7f72d22-1fd4-11e7-8705-73a3e5b2da91.png)\r\n\r\nTo celebrate the dual birthdays - this repository turning three and [BOSH itself turning five](https://www.cloudfoundry.org/bosh-turns-five/) - we've done a major upgrade to this project to bring it into line with the exciting features in BOSH 2.0.\r\n\r\nThis release also includes the introduction of a companion project https://github.com/cloudfoundry-community/docker-broker-deployment - the one-stop shop for deploying the Open Service Broker API that can deploy anything as a service, via Docker!\r\n\r\nThe git commits + comments for this work is primarily in this PR https://github.com/cloudfoundry-community/docker-boshrelease/pull/79\r\n\r\nIn the news/blog world:\r\n\r\n* https://www.starkandwayne.com/blog/adding-docker-based-services-to-your-cloud-foundry-with-bosh2/\r\n\r\n## Improvements\r\n\r\n* **Security** - Docker is now deployed with TLS certificates. This was made very simple to add thanks to `bosh2` ability to generate certificates locally or via credhub.\r\n* **Simplicity** - `manifests/` subfolders should all work on **any** BOSH director - from local virtualbox to AWS/Azure/Google/OpenStack/Vsphere. Same manifest. Incredible. xoxo to BOSH 2.0.\r\n* **Clusters** - the `manifests/broker/docker-broker.yml` manifest assumes you'll want many Docker VMs and so includes the `cf-subway` broker by default, and deploys 3 docker host VMs by default.\r\n* **BOSH 2.0** - you'll be fully supported by `bosh2` CLI, BOSH Links, and BOSH Cloud Config. You'll feel cooler. More awesome. You'll probably be more generous and good spirited. You'll pick up little bits of trash that you see on the street. You'll probably become fitter and healthier too. I don't have these results demonstrated in the CI system so your milage may vary.\r\n* **CI** - the whole project is now covered by a CI system.\r\n\r\nHow CI looks today:\r\n\r\n[![screen shot 2017-04-12 at 5 21 53 pm](https://cloud.githubusercontent.com/assets/108/24984780/8e83691e-1fa4-11e7-80a2-32e7bc00eb40.png)](https://ci.starkandwayne.com/teams/main/pipelines/docker-boshrelease)\r\n\r\n\r\n### Niceness\r\n\r\n* When you SSH into a Docker VM, you will automatically have the `docker` CLI preconfigured to target the local Docker daemon.\r\n* When you SSH into a Docker VM, you will have the visually delightful `ctop` CLI installed.\r\n\r\n![ctop](https://github.com/cloudfoundry-community/docker-boshrelease/raw/master/manifests/containers/ctop-example.png)\r\n\r\n## Assumptions\r\n\r\nVersion v30 and onwards makes the exciting assumptions:\r\n\r\n* deployment user will be targeting a modern BOSH director (for example, see https://github.com/cloudfoundry/bosh-deployment)\r\n* deployment user will be using `bosh2` CLI https://github.com/cloudfoundry/bosh-cli/\r\n* deployment BOSH director has/will be using cloud-config\r\n* you are excited about all things BOSH 2 and are ready to move forward\r\n* you might want to continue deploying any of the aged service images - so they've all been kepted; but if you'd like to help upgrade them please let me know!\r\n\r\n## Warnings\r\n\r\nThis release **should** be a drop-in upgrade for any systems running v29. I do suggest testing any upgrades on staging environments first. Please.\r\n\r\nIf you would like assistance or hand holding during this process, please let me know.\r\n\r\nMany many of the BOSH job properties have changed or been simplified. For example, `docker.` prefixes have been removed. All property namespace prefixes are gone. Manifests are so much nicer now.\r\n\r\nI highly recommend you move away from your current manifests to the new manifests which are deliciously simple.\r\n\r\n## Unchanged\r\n\r\n* Still docker 1.13\r\n* Static container definitions\r\n* Service broker should run containers the same way it did before\r\n\r\n## Deployment\r\n\r\nSee https://github.com/cloudfoundry-community/docker-boshrelease/tree/master/manifests for usage scenarios and deployment instructions for each.\r\n\r\nIf you're deploying the Docker Broker system, it has its own dedicated repo to make life simpler for you - https://github.com/cloudfoundry-community/docker-broker-deployment\r\n\r\nDeployment manifest snippet:\r\n\r\n```yaml\r\nreleases:\r\n- name: docker\r\n  version: 30.0.0\r\n  url: https://github.com/cloudfoundry-community/docker-boshrelease/releases/download/v30.0.0/docker-30.0.0.tgz\r\n  sha1: d0936ebf27b2d7950fcc9042720b6fd28bcb631b\r\n```\r\n\r\nOr `bosh2` operator patch file:\r\n\r\n```yaml\r\n- type: replace\r\n  path: /releases/name=docker\r\n  value:\r\n    version: 30.0.0\r\n    url: https://github.com/cloudfoundry-community/docker-boshrelease/releases/download/v30.0.0/docker-30.0.0.tgz\r\n    sha1: d0936ebf27b2d7950fcc9042720b6fd28bcb631b\r\n```"
}